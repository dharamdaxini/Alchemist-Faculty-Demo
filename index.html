<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ALCHEMIST | V170 FINAL MASTER</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;1,400&family=Inter:wght@400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --bg: #05080f; --card-bg: #0b172a; --dock-bg: #0f203a; 
            --border: #1e2f4a; --accent: #38bdf8; --text-main: #f0f4f8; 
            --text-sub: #64748b; --gold: #fbbf24; --rank-a: #8b5cf6;
            --font-ui: 'Inter', sans-serif; --font-book: 'Crimson Pro', serif;       
            --font-code: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        body { margin: 0; height: 100vh; background: var(--bg); color: var(--text-main); font-family: var(--font-ui); overflow: hidden; display: flex; flex-direction: column; }

        #stage { flex-grow: 1; position: relative; overflow: hidden; perspective: 1000px; }

        .card { 
            position: absolute; width: 360px; left: 50%; margin-left: -180px; 
            bottom: 220px; top: 70px; background: var(--card-bg); 
            border-radius: 20px 20px 0 0; border: 1px solid var(--border); border-bottom: none;
            display: flex; flex-direction: column; box-shadow: 0 -10px 40px rgba(0,0,0,0.5); 
            transform-origin: center bottom; will-change: transform; overflow: hidden; z-index: 5;
        }

        .rank-tag { 
            position: absolute; top: 15px; left: 20px; font-size: 0.65rem; font-weight: 900; 
            letter-spacing: 1px; color: var(--gold); border: 1px solid var(--gold); 
            padding: 2px 8px; border-radius: 4px; z-index: 10;
        }
        .rank-a-glow { border-color: var(--rank-a); color: var(--rank-a); box-shadow: 0 0 15px rgba(139, 92, 246, 0.4); }

        .card-top { flex-grow: 1; padding: 45px 24px 24px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; position: relative; }
        .goal-header { position: absolute; top: 45px; font-size: 0.7rem; font-weight: 700; color: var(--text-sub); text-transform: uppercase; letter-spacing: 1px; }
        .card-q { font-family: var(--font-book); font-size: 1.6rem; font-weight: 600; line-height: 1.3; color: #fff; }
        .card-overlay-text { position: absolute; top: 55%; left: 50%; transform: translate(-50%, -50%); font-family: var(--font-book); font-size: 1.4rem; font-weight: 600; color: #fff; opacity: 0; pointer-events: none; width: 90%; text-align: center; text-shadow: 0 5px 20px rgba(0,0,0,1); }

        .card-dock { position: absolute; bottom: 0; left: 0; width: 100%; height: 220px; background: var(--dock-bg); border-top: 2px solid var(--gold); display: flex; flex-direction: column; justify-content: center; padding: 10px 0; z-index: 10; }
        .dock-col { display: flex; flex-direction: row; align-items: center; justify-content: space-between; flex: 1; padding: 8px 24px; border-bottom: 1px solid var(--border); transition: 0.2s; }
        .dock-label { font-size: 0.6rem; font-weight: 800; color: var(--text-sub); width: 60px; flex-shrink: 0; }
        .dock-val { font-family: var(--font-book); font-size: 1.05rem; color: var(--text-main); font-weight: 600; text-align: right; flex: 1; }
        .dock-col.active { background: rgba(56, 189, 248, 0.2); }

        #header { width: 100%; height: 70px; display: flex; justify-content: space-between; align-items: center; padding: 0 24px; border-bottom: 1px solid var(--border); }
        .stat-pill { background: #000; padding: 6px 12px; border-radius: 4px; font-size: 0.7rem; border: 1px solid var(--border); font-family: var(--font-code); color: var(--accent); }
        .progress-line { position: fixed; bottom: 0; left: 0; height: 3px; background: var(--accent); width: 0%; transition: width 0.4s; z-index: 100; }

        #analysis-modal { position: fixed; inset: 0; background: #05080f; z-index: 5000; display: none; flex-direction: column; padding: 40px 30px; }
        #analysis-modal.open { display: flex; }
        .analysis-block { background: #0b172a; padding: 25px; border-radius: 12px; border-left: 4px solid var(--gold); text-align: left; font-family: var(--font-book); line-height: 1.6; color: #e2e8f0; font-size: 1.2rem; margin-bottom: 25px; }
        .next-step-item { background: rgba(56, 189, 248, 0.1); border: 1px solid var(--border); padding: 15px; border-radius: 8px; font-size: 0.9rem; margin-bottom: 12px; color: var(--accent); font-family: var(--font-ui); }
        .modal-btn { background: var(--text-main); color: #000; border: none; padding: 20px; border-radius: 12px; font-weight: 800; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div id="session-view">
        <div id="header">
            <div id="meta-label" style="font-size: 0.65rem; color: var(--text-sub); font-weight: 900; letter-spacing: 2px;">ALCHEMIST V170</div>
            <div class="stat-pill" id="score-disp">MASTERY: 0%</div>
        </div>
        <div id="stage">
            <div class="card-dock">
                <div class="dock-col" id="col-left"><div class="dock-label">LEFT</div><div class="dock-val" id="val-l">...</div></div>
                <div class="dock-col" id="col-up"><div class="dock-label">UP</div><div class="dock-val" id="val-u">...</div></div>
                <div class="dock-col" id="col-right"><div class="dock-label">RIGHT</div><div class="dock-val" id="val-r">...</div></div>
            </div>
        </div>
        <div class="progress-line" id="progress"></div>
    </div>

    <div id="analysis-modal">
        <div style="flex:1; overflow-y:auto;">
            <div style="font-size: 0.7rem; color: var(--text-sub); font-weight: 800; margin-bottom: 10px; letter-spacing: 2px; text-transform: uppercase;">Theoretical Framework</div>
            <div class="analysis-block" id="modal-analysis"></div>
            <div style="font-size: 0.7rem; color: var(--text-sub); font-weight: 800; margin-bottom: 10px; letter-spacing: 2px; text-transform: uppercase;">Research Objectives</div>
            <div id="modal-next"></div>
        </div>
        <button class="modal-btn" onclick="closeModal()">Commit Analysis</button>
    </div>

<script>
/**
 * CANONICAL V170_MASTER_SET
 * Logic: Merged Stream (FAC-series + MSTR-series)
 */
const POOL = [
  {
    "id": "FAC_01", "rank": "A", "domain": "THERMO", "goal": "Equilibrium Constant",
    "question": "What is the relationship between $K_p$ and $K_c$ for $N_2 + 3H_2 \\rightleftharpoons 2NH_3$?",
    "opt_up": "$K_p = K_c(RT)^{-2}$", "opt_right": "$K_p = K_c(RT)^{2}$", "opt_left": "$K_p = K_c(RT)$",
    "correct": "UP", "expl_up": "Correct. $\\Delta n = 2 - 4 = -2$.", "expl_right": "Incorrect. This assumes a positive change in gas moles.", "expl_left": "Incorrect. This neglects the exponent related to stoichiometry.",
    "analysis": "<b>Physical Principle:</b> The relationship between $K_p$ and $K_c$ is defined as $K_p = K_c(RT)^{\\Delta n}$. In the Haber process, $\\Delta n_{gas} = 2 - (1 + 3) = -2$.",
    "next_steps": "1. Derive the thermodynamic relation between $K_p$ and $\\Delta G^{\\circ}$. 2. Analyze pressure effects via Le Ch√¢telier's principle."
  },
  {
    "id": "MSTR_077", "rank": "A", "domain": "ORGANIC", "goal": "Curtin-Hammett Principle",
    "question": "In interconverting conformers A $\\rightleftharpoons$ B, what determines the product ratio $P_A : P_B$?",
    "opt_up": "Relative energies of transition states", "opt_right": "Relative populations of conformers", "opt_left": "Speed of interconversion alone",
    "correct": "UP", "expl_up": "CORRECT. Selectivity is a function of the free energy difference between transition states.",
    "expl_right": "TRAP. Ground-state stability does not dictate product outcome in fast-equilibrating systems.", "expl_left": "INCOMPLETE. Absolute rates matter, but the ratio depends on barrier heights.",
    "analysis": "<b>Physical Principle:</b> The <b>Curtin-Hammett Principle</b> states that product distribution depends solely on the relative energies of the transition states ($\Delta\Delta G^{\ddagger}$), regardless of ground-state equilibrium concentrations.",
    "next_steps": "1. Research the deamination of 4-t-butylcyclohexylamines. 2. Model conformer kinetics using Python simulations."
  },
  {
    "id": "MSTR_102", "rank": "A", "domain": "KINETICS", "goal": "Marcus Inverted Region",
    "question": "In Marcus Theory, what happens to the rate when driving force ($-\\Delta G^{\\circ}$) exceeds reorganization energy ($\\lambda$)?",
    "opt_up": "The reaction rate decreases", "opt_right": "The reaction rate increases", "opt_left": "The reaction rate remains constant",
    "correct": "UP", "expl_up": "CORRECT. The crossing point of potential energy surfaces moves back, increasing the barrier.",
    "expl_right": "TRAP. This intuition fails in the highly exothermic inverted regime.", "expl_left": "INCORRECT. The rate is highly sensitive to changes in the driving force in this region.",
    "analysis": "<b>Physical Principle:</b> In the <b>Marcus Inverted Region</b>, the activation energy increases as the reaction becomes more exothermic ($-\\Delta G^{\\circ} > \\lambda$), leading to a paradoxically slower rate.",
    "next_steps": "1. Analyze photosynthetic charge separation centers. 2. Calculate reorganization energy using DFT methods."
  }
  // PASTE ALL 102 OBJECTS HERE FROM YOUR MERGER EXPORT
];

let INDEX = 0, SCORE = 0;

function renderCard() {
    if (INDEX >= POOL.length) { renderEnd(); return; }
    const data = POOL[INDEX];
    
    document.getElementById('meta-label').innerText = data.domain + " | " + data.id;
    document.getElementById('val-u').innerHTML = data.opt_up;
    document.getElementById('val-r').innerHTML = data.opt_right;
    document.getElementById('val-l').innerHTML = data.opt_left;

    const card = document.createElement('div');
    card.className = "card";
    // Standard Concatenation to avoid Template Literal Bug
    const rankClass = (data.rank === 'A') ? "rank-tag rank-a-glow" : "rank-tag";
    card.innerHTML = '<div class="' + rankClass + '">RANK ' + data.rank + '</div>' +
                     '<div class="card-top">' +
                     '<div class="goal-header">' + data.goal + '</div>' +
                     '<div class="card-q" id="q-text">' + data.question + '</div>' +
                     '<div class="card-overlay-text" id="ov-text"></div>' +
                     '</div>';
    
    document.getElementById('stage').appendChild(card);
    bindPhysics(card, data);
}

function bindPhysics(el, data) {
    let startX, startY, isDragging = false;
    const pivotY = window.innerHeight - 220, pivotX = window.innerWidth / 2;
    const qT = el.querySelector('#q-text'), ovT = el.querySelector('#ov-text');
    const cols = { UP: document.getElementById('col-up'), RIGHT: document.getElementById('col-right'), LEFT: document.getElementById('col-left') };

    el.addEventListener('touchstart', e => { 
        isDragging = true; startX = e.touches[0].clientX; startY = e.touches[0].clientY; el.style.transition = 'none';
    });

    window.addEventListener('touchmove', e => {
        if (!isDragging) return;
        const cx = e.touches[0].clientX, cy = e.touches[0].clientY;
        const dist = Math.sqrt(Math.pow(cx - startX, 2) + Math.pow(cy - startY, 2));
        let ang = Math.atan2(cx - pivotX, -(cy - pivotY)) * (180 / Math.PI);
        el.style.transform = 'rotate(' + Math.max(-8, Math.min(8, ang)) + 'deg)';
        const progress = Math.min(Math.max(0, dist - 20) / 80, 1);
        qT.style.opacity = 1 - progress; ovT.style.opacity = progress;

        Object.values(cols).forEach(c => c.classList.remove('active'));
        let sel = "UP"; if (ang < -15) sel = "LEFT"; else if (ang > 15) sel = "RIGHT";
        cols[sel].classList.add('active');
        ovT.innerHTML = '<span style="font-size:0.8rem; color:var(--gold); display:block; margin-bottom:8px;">HEURISTIC</span>' + data['expl_' + sel.toLowerCase()];
    });

    window.addEventListener('touchend', e => {
        if (!isDragging) return; isDragging = false;
        const ex = e.changedTouches[0].clientX, ey = e.changedTouches[0].clientY;
        const total = Math.sqrt(Math.pow(ex - startX, 2) + Math.pow(ey - startY, 2));
        const ang = Math.atan2(ex - pivotX, -(ey - pivotY)) * (180 / Math.PI);
        // HARD STRETCH LOGIC: RANK A = 160px
        const threshold = (data.rank === "A") ? 160 : 110;

        if (total > threshold) {
            let dir = "UP"; if (ang < -15) dir = "LEFT"; else if (ang > 15) dir = "RIGHT";
            finishSwipe(el, data, dir);
        } else { resetCard(el); }
    });
}

function finishSwipe(el, data, dir) {
    const isCorr = (dir === data.correct);
    el.style.transition = 'transform 0.4s ease-in, opacity 0.4s'; el.style.opacity = '0';
    el.style.transform = 'translate(' + (dir === "UP" ? 0 : (dir === "LEFT" ? -500 : 500)) + 'px, ' + (dir === "UP" ? -500 : 0) + 'px)';
    if(isCorr) SCORE++;
    document.getElementById('score-disp').innerText = "MASTERY: " + Math.round((SCORE/(INDEX+1))*100) + "%";
    document.getElementById('progress').style.width = ((INDEX+1)/POOL.length)*100 + "%";
    setTimeout(() => { showAnalysis(data); el.remove(); }, 300);
}

function showAnalysis(data) {
    document.getElementById('modal-analysis').innerHTML = data.analysis;
    const steps = data.next_steps.split('. ').map(s => '<div class="next-step-item">' + s + '</div>').join('');
    document.getElementById('modal-next').innerHTML = steps;
    document.getElementById('analysis-modal').classList.add('open');
}

function closeModal() { document.getElementById('analysis-modal').classList.remove('open'); INDEX++; renderCard(); }
function resetCard(el) { el.style.transition = '0.3s ease'; el.style.transform = 'rotate(0deg)'; el.querySelector('#q-text').style.opacity = 1; el.querySelector('#ov-text').style.opacity = 0; }
function renderEnd() { document.getElementById('stage').innerHTML = '<div class="card" style="justify-content:center; align-items:center;"><div class="card-q">CALIBRATION COMPLETE</div><button class="modal-btn" onclick="location.reload()" style="width:80%; margin-top:30px;">RESTART</button></div>'; }
renderCard();
</script>
</body>
</html>
